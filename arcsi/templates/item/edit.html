{% extends 'base.html' %}

{% block header %}
<h2>{% block title %}Edit episode item{% endblock %}</h2>
{% endblock %}

{% block content %}
<form action="{{ url_for('arcsi.archon_edit_item', id=item.id) }}" method="post" enctype="multipart/form-data">

<article class="add-infos">
  <h3>Information</h3>
  <div>
    <label for="shows">Episode of</label>
    {% if current_user.has_role("admin") %}
    <input type="hidden" name="show_name" id="show_name" value="{{ shows[0].name }}">
    <select name="shows" id="shows"
      onchange="this.previousElementSibling.value=this.options[this.selectedIndex].text">
      <option value="{{item.shows[0].id}}">{{ item.shows[0].name }}</option>
      {% for show in shows %}
      <option value="{{ show.id }}">{{ show.name }}</option>
      {% endfor %}
    </select>
    {% else %}
      <p value="{{ item.shows[0].id }}">{{ item.shows[0].name }}</p>
    {% endif %}
  </div>

  <div>
    <label for="number">Episode number *</label>
    <input type="number" name="number" id="number" value="{{ item.number }}">
  </div>

  <div>
    <label for="name">Episode name *</label>
    <input name="name" id="name" value="{{ item.name }}">
  </div>

  <div>
    <label for="description">Episode description</label><br>
    <textarea name="description" id="description" value="{{ item.description }}">{{ item.description }}</textarea>
  </div>

  <div>
    <label for="external_url">External link</label>
    <input name="external_url" id="external_url" value="{{ item.external_url }}">
  </div>

  <div>
    <label for="language">Episode language *</label>
    <select name="language" id="language">
      <option id="music" value="music" {% if item.language=="music" %} selected {% endif %}>Music</option>
      <option id="hu_hu" value="hu_hu" {% if item.language=="hu_hu" %} selected {% endif %}>Magyar</option>
      <option id="en_uk" value="en_uk" {% if item.language=="en_uk" %} selected {% endif %}>English</option>
    </select>
  </div>

  <div>
    <label for="taglist">Item tag list (separate with commas)</label>
    <!-- TODO remove or handle properly the last individual comma -->
    <input name="taglist" id="taglist" value="{% for tag in item.tags %}{{tag.display_name}},{% endfor %}">
  </div>

  <h3>Radio</h3>
  {% if item.airing %}
  <div>
    <p>{{ item.name }} is currently on air.</p>
  </div>
  {% endif %}
  <div>
    <label>Original broadcast was</label>
    <p>{% if item.live %} <span>Live</span> {% else %} <span>Recording</span> {% endif %}</p>
  </div>
  <div>
    <label for="play_date">Played on</label>
    <input type="date" name="play_date" id="play_date" value="{{ item.play_date }}">
  </div>
  <div>
    <label for="broadcast">Broadcast on air</label>
    <input type="hidden" id="broadcast" name="broadcast" value="0">
    <input type="checkbox" onclick="this.previousElementSibling.value=this.checked?1:0">
  </div>
  <!-- TODO check how to refactor; submits with diff value and value parsed on srv; or
       offer edit types, only info, archive or broadcast -->
  <h3>Archive</h3>
  <div>
    <label for="archive_lahmastore">Archive to Lahmastore</label>
    <input type="hidden" id="archive_lahmastore" name="archive_lahmastore" value="0">
    <input type="checkbox" onclick="this.previousElementSibling.value=this.checked?1:0">
    <!-- TODO updated_at ? uploader means anything here? -->
    <input type="hidden" name="uploader" id="uploader" value="{{ current_user.email }}">
  </div>

  <div>
    <p>For <b>Live</b> episodes please use an <b>image</b> between <b>200-500 kB</b></p>
    <p>For <b>Broadcasted</b> episodes next to the <b>image</b> please upload the <b>audio</b> in <b>.mp3</b> format</p>
    <p>Files attached apply to archive or broadcast or both</p>
  </div>
  
  <div class="add-media">
  <div>
    <label for="play_file">Audio file</label>
    <input type="file" accept= ".mp3" name="play_file" id="play_file" value="{{ item.play_file_name }}">
    <span onclick="play_file.value=''">X</span>
  </div>

  <div>
    <label for="image_file">Episode cover image</label>
    <input type="file" accept= "image/*" name="image_file" id="image_file" value="{{ item.image_url }}">
    <span onclick="image_file.value=''">X</span>
  </div>
  </div>
  <div>
    <input type="submit" value="Update">
  </div>
</article>
</form>

{{ ckeditor.load(pkg_type="basic") }}
{{ ckeditor.config(name="description") }}

{% endblock %}
